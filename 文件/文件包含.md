
# 文件包含

包含的，就是方便开发使用：

![image-20250312202752127](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621096.png)

就是产生在你s调用包含文件的时候，比如php里面的 include 'config.php' ，这样就方便直接调用config.php里面的文件，就不需要你在重新写一遍config.php里的代码，但是如果这里的config.php可以控制，就容易产生问题。

PHP：include、require、include_once、require_once等

![image-20250313231246053](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621097.png)

![image-20250313231545689](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621098.png)

 演示   远程文件包含	条件：远程包含开关开启	只需要改远程文件，实现远程rce

![image-20250313232500173](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621099.png)

那么显然：漏洞的成因：1、使用了文件包含函数	2、包含的文件是可控的

自然，上面file后面也可以是一个远程的地址文件，实现远程代码执行。也就是远程文件包含：

需要先开启远程包含或者代码中为on

![image-20250313233745072](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621100.png)

![image-20250313233842960](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621101.png)

但是还是比较鸡肋，因为在php高版本以上都是关的。

   利用

本地包含：1、有文件 利用 	2、无文件利用

有文件利用：（有文件上传点）

<?php eval($_post['pass']);?> 

那就直接上传我们的后门文件。





#### 无文件利用

  无文件利用（也就是说没有上传文件点） ：

1、伪协议 	2、文件读取       ，  3、文件写入 	代码执行	

1、配合文件上传

2、无文件包含日志

3、无文件包含SESSION

4、无文件支持伪协议利用

文件读取：file是需要绝对路径	php只需要相对路径，进行base64编码，这里是规则。

![image-20250312214339646](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621102.png)

  演示

1、发现可能 存在文件读取

![image-20250315174042850](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621103.png)

   ctf

利用日志包含，日志记录功能。 

这里过滤了php字段，就用data协议：

![image-20250315181326428](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621104.png)

既过滤data又过滤了php，这里就用到日志包含：

![image-20250315183206537](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621105.png)

并且发现这里的日志会记录一会ua头等信息，就尝试能不能写入ua头里的shell，从而拿shell：

![image-20250315183455001](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621106.png)

SESSION包含：

利用session，访问会自己存储到默认路径下，那么就利用这点，实现包含.

   session 每次访问网站时，会自动产生对应的seesion	但是访问完会删除session文件，清空。所以这里就是条件竞争，一直发包让其将session里面的语句写入。这样：

![image-20250312220659445](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621107.png)

![image-20250315220829611](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621108.png)

就是条件竞争，一直发包让其写入，然后客户端一直访问网站，让服务器触发发的包：

![image-20250315221134839](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161621109.png)
